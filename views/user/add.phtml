<section class="login-bg d-flex align-items-center justify-content-center min-vh-100 w-100">
  <div class="login-card card border-0 shadow-lg p-4 mx-auto">
    <div class="text-center mb-3">
      <span class="material-icons icon-login" style="font-size: 2.5rem; color: #0D6EFD;">groups</span>
    </div>
    <h2 class="text-center fw-bold mb-2 text-primary">Cadastro de Anunciante</h2>
    <p class="text-center text-secondary mb-4 subtitle-login">
      Crie sua conta para anunciar no sistema
    </p>
    <form id="cadastroForm" novalidate autocomplete="off">
      <div class="form-floating-icon mb-4">
        <input type="text" id="nome" name="nome" class="form-control form-control-lg" placeholder=" " required minlength="3" autocomplete="name">
        <label for="nome">
          <span class="material-icons me-2" style="vertical-align: middle;">person</span>Nome completo
        </label>
        <div class="invalid-feedback">
          Por favor, insira seu nome completo (mínimo 3 letras).
        </div>
      </div>
      <div class="form-floating-icon mb-4">
        <input type="email" id="email" name="email" class="form-control form-control-lg" placeholder=" " required autocomplete="username">
        <label for="email">
          <span class="material-icons me-2" style="vertical-align: middle;">mail</span>E-mail
        </label>
        <div class="invalid-feedback">
          Por favor, insira um e-mail válido.
        </div>
      </div>
      <div class="form-floating-icon mb-4">
        <input type="password" id="password" name="password" class="form-control form-control-lg" placeholder=" " required minlength="4" autocomplete="new-password">
        <label for="password">
          <span class="material-icons me-2" style="vertical-align: middle;">lock</span>Senha
        </label>
        <button class="btn btn-eye" type="button" id="togglePassword" tabindex="-1">
          <span class="material-icons" id="eyeIcon">visibility</span>
        </button>
        <div class="invalid-feedback">
          Por favor, insira uma senha válida (mínimo 4 caracteres).
        </div>
      </div>
      <div class="form-check mb-4 text-start">
        <input class="form-check-input" type="checkbox" value="" id="termos" required>
        <label class="form-check-label small ms-1" for="termos">
          Aceito os <a href="#" class="text-primary text-decoration-underline">termos de uso</a>
        </label>
        <div class="invalid-feedback">
          Você deve aceitar os termos para continuar.
        </div>
      </div>
      <button type="submit" class="btn btn-primary w-100 btn-lg rounded-3 mt-2 shadow-sm">Cadastrar</button>
      <div class="mt-4 text-center small">
        Já tem conta?
        <a href="/login" class="text-decoration-none">Entrar</a>
      </div>
    </form>
  </div>
</section>

<script>
  (function () {
    'use strict';
    const form = document.getElementById('cadastroForm');
    const nome = document.getElementById('nome');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const termos = document.getElementById('termos');

    [nome, email, password, termos].forEach(function(input) {
      input.addEventListener('input', function() {
        input.classList.remove('is-invalid');
      });
    });

    form.addEventListener('submit', function (event) {
      var valid = true;

      if (!nome.value || nome.value.length < 3) {
        nome.classList.add('is-invalid');
        valid = false;
      }
      if (!email.value || !email.checkValidity()) {
        email.classList.add('is-invalid');
        valid = false;
      }
      if (!password.value || password.value.length < 4) {
        password.classList.add('is-invalid');
        valid = false;
      }
      if (!termos.checked) {
        termos.classList.add('is-invalid');
        valid = false;
      }

      if (!valid) {
        event.preventDefault();
        event.stopPropagation();
      }

      form.classList.add('was-validated');
    }, false);
  })();

  // Exibir/ocultar senha com Material Icons
  document.getElementById('togglePassword').addEventListener('click', function () {
    var passwordInput = document.getElementById('password');
    var eyeIcon = document.getElementById('eyeIcon');
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.textContent = 'visibility_off';
    } else {
      passwordInput.type = 'password';
      eyeIcon.textContent = 'visibility';
    }
  });

  
function add(): void
{
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $nome = $_POST['nome'] ?? '';
        $email = $_POST['email'] ?? '';
        $senha = $_POST['password'] ?? '';
        // Valide os dados e faça hash da senha!
        if ($nome && $email && $senha) {
            // Exemplo: usando Doctrine
            $entityManager = $this->getEntityManager();
            $user = new User();
            $user->setName($nome);
            $user->setEmail($email);
            $user->setPassword(password_hash($senha, PASSWORD_DEFAULT));
            $entityManager->persist($user);
            $entityManager->flush();
            header('Location: /login');
            exit;
        }
        // Se erro, pode exibir mensagem na view
    }
    $this->render(self::VIEW_ADD);
}
</script>